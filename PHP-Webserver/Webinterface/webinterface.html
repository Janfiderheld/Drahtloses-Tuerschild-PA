<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="utf-8"/>
	<title>Türschild - Config</title>
</head>
<body onload="reloadAndGetData()">
	<h1>Einrichtung des Türschilds</h1>
	<hr>
	
	<h3>1) Anpassung des Zustands für das Feld "Ich bin..."</h3>
	
	<form action="">
		<input id="rbAnwesend" type="radio" name="stateOfProf" value="anwesend" checked="checked">anwesend<br>
		<input id="rbAbwesend" type="radio" name="stateOfProf" value="abwesend">abwesend<br>
		<input id="rbKrank" type="radio" name="stateOfProf" value="krank">krank<br>
		<input id="rbUrlaub" type="radio" name="stateOfProf" value="im Urlaub">im Urlaub<br>
		<input id="rbPause" type="radio" name="stateOfProf" value="in der Pause">in der Pause
	</form>
	
	<hr style="border:dashed #6E6E6E 2px">

	<h3>Freitext erstellen</h3>
	<textarea id="newMessage" rows="5" cols="200" style="resize:none">Geben Sie hier die neue Meldung ein!</textarea>
	<p style="font-size: 11px; font-style: italic">Hinweis: Dieses Feld leer lassen um keine Änderungen vorzunehmen!</p>
	
	<h4>Aktuell werden folgende Meldungen angezeigt:</h4>

	<p id="oldMessageTop">Ich bin eine alte Meldung</p>
	<p id="oldMessageBottom">Ich auch</p>
	
	<button type="submit" value="Submit" onclick="btnConfirm()">Bestätigen</button>
	<button type="cancel" value="Cancel" onclick="btnCancel()">Abbrechen</button>

	<p style="font-size: 10px">
		Project by Niclas Muss & Jan-Philipp Töberg<br>
		<a style="font-size: 10px" href="https://github.com/Janfiderheld/Drahtloses-Tuerschild-PA">Link zum Projekt auf Github</a>
	</p>	
</body>

<script type="text/javascript">
	function reloadAndGetData() {
		var httpc2 = new XMLHttpRequest();
		var url = "getDataFromCSV.php";
		httpc2.open("POST", url, true);
		
		httpc2.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		
		httpc2.onreadystatechange = function() { 
			if(httpc2.readyState == XMLHttpRequest.DONE && httpc2.status == 200) {				
				var dataFromJSON = JSON.parse(httpc2.responseText);	
				
				document.getElementById("oldMessageTop").innerHTML = dataFromJSON.newsNew;
				document.getElementById("oldMessageBottom").innerHTML = dataFromJSON.newsOld;
				
				var radiobuttonTemp;
				
				switch(dataFromJSON.status) {
					case "anwesend":
						radiobuttonTemp = document.getElementById("rbAnwesend");
						break;
					case "abwesend":
						radiobuttonTemp = document.getElementById("rbAbwesend");
						break;
					case "krank":
						radiobuttonTemp = document.getElementById("rbKrank");
						break;
					case "im Urlaub":
						radiobuttonTemp = document.getElementById("rbUrlaub");
						break;
					case "in der Pause":
						radiobuttonTemp = document.getElementById("rbPause");
						break;
				}
				radiobuttonTemp.checked = true;
			}				
		}
		httpc2.send(null);
		
		document.getElementById("newMessage").value = "Geben Sie hier die neue Meldung ein!";
	}

	function btnConfirm() {
		var lastMessageNew = document.getElementById("oldMessageTop").innerHTML;
		var lastMessageOld = document.getElementById("oldMessageBottom").innerHTML;
		var contentOfTextArea = document.getElementById("newMessage").value;
		var chosenStateOfProf = "undefined";
		
		var buttons = document.forms[0];		
		for(var i = 0; i < buttons.length; i++) {
			if(buttons[i].checked) {
				chosenStateOfProf = buttons[i].value;
			}
		}
		
		sendToPHP(chosenStateOfProf, contentOfTextArea, lastMessageNew, lastMessageOld);
	}
	
	function sendToPHP(stateOfProf, newsToWrite, lastNewNews, lastOldNews) {
		var httpc = new XMLHttpRequest();
		var url = "saveDataToCSV.php";
		httpc.open("POST", url, true);
		
		httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		// httpc.setRequestHeader("Content-Length", dataToSend.length);
		
		httpc.onreadystatechange = function() { 
			if(httpc.readyState == XMLHttpRequest.DONE && httpc.status == 200) {
				// alert(httpc.responseText);
				console.log(this.responseText);
				location.reload();
			}
		}
		 
		httpc.send("zustand=" + stateOfProf + "&meldungWrite=" + newsToWrite + "&meldung1=" + lastNewNews + "&meldung2=" + lastOldNews);
	}
	
	function btnCancel() {
		location.reload();
	}
</script>
</html>